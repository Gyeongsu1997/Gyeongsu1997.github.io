---
layout: single
title:  "바닐라 자바스크립트로 리액트 useState 훅 만들기"
category: VanillaJS
tags:
  - JavaScript
  - React
toc: true
---

> 부스트캠프에서 마스터로 활동하고 계신 황준일님이 쓰신 [Vanilla Javascript로 React UseState Hook 만들기](https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Make-useSate-hook/){:target="_blank"}를 먼저 읽고 읽으면 이해하기 수월합니다.

## 1. 개요

[지난 포스팅](https://gyeongsu1997.github.io/vanillajs/function-components/)에서 함수형 컴포넌트를 만들어 보았습니다. 하지만 이것으론 부족합니다. 그렇습니다. 우리가 만든 컴포넌트의 상태를 관리하기 위해서는 Hook이 필요합니다. 오늘은 리액트의 useState 훅을 만들어보겠습니다.

## 2. useState 훅의 원리

리액트에서 useState 훅은 아래와 같이 사용됩니다.

<script src="https://gist.github.com/Gyeongsu1997/94969151118b3ef182524ae737d024c9.js?file=App.js"></script>

useState 훅을 호출하면 state와 state를 변경하는 setState 함수가 배열의 형태로 반환되며, setState 함수를 호출하면 state가 변경되면서 컴포넌트가 재렌더링됩니다. 컴포넌트가 재렌더링되면서 useState 함수가 다시 한 번 호출되는데 state 값은 초기화되지 않습니다. 어떻게 이게 가능한 걸까요? 그것은 state를 useState 함수 외부에서 관리하기 때문입니다.

아래와 같이 state를 useState 함수 내부에서 관리할 경우에는 useState가 호출될 때마다 state가 초기화되겠죠. 결국 화면에는 계속 0만 표시될 것입니다.

<script src="https://gist.github.com/Gyeongsu1997/94969151118b3ef182524ae737d024c9.js?file=state-in-usestate.html"></script>

그래서 state는 useState 함수 외부에서 관리해야 합니다. 그리고 state는 한 개가 아니라 여러 개일 수 있으니 state의 배열을 만들어 관리하도록 하겠습니다.

<script src="https://gist.github.com/Gyeongsu1997/94969151118b3ef182524ae737d024c9.js?file=state-outside-usestate.html"></script>

핵심적인 부분은 useState 함수가 실행될 때마다 기존에 넣어 놓은 상태가 존재하는 지 확인해서 만약 있다면 기존의 상태를 그대로 사용하고, 없다면 새로운 상태를 배열에 넣는 것입니다. useState 함수가 실행될 때마다 currentStateKey가 1씩 증가하며 렌더링이 끝나면 초기화됩니다. 여기서 리액트 훅의 또 하나의 중요한 특징을 도출할 수 있습니다. 바로 **React Hook은 항상 top level에서만 호출해야 한다는 것입니다.** 이 규칙은 컴포넌트가 재렌더링될 때 동일한 순서로 Hook이 호출되는 것을 보장하기 위함입니다. 만약 렌더링할 때마다 Hook이 호출되는 순서가 달라진다면 위 states 배열에서 관리하는 state들의 순서가 꼬이게 되어 이전에 참조하던 state와 현재의 state가 동일한 것인지 보장할 수 없게 됩니다.

## Reference

- [Vanilla Javascript로 React UseState Hook 만들기](https://junilhwang.github.io/TIL/Javascript/Design/Vanilla-JS-Make-useSate-hook/){:target="_blank"}


